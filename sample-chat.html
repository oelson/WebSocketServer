<!DOCTYPE html>
<html>
	<head>
		<title>WebSocket Example</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<style>
		body
		{
			font-size: 16px;
		}
		
		p
		{
			font-size: 1em;
			white-space: pre-line;
			backgroud-color: red;
			margin: 4px 8px 24px 4px;
			font-family: ubuntu, arial, sans;
		}
		textarea
		{
			font-size: 1em;
			font-family: ubuntu, arial, sans;
		}
		</style>
	</head>
	<body>
		<input type="text" name="nick" id="nick" value="Anonymous">
		<br>
		<textarea value="" id="msg" rows="3" cols="60"></textarea>
		<div id="output"></div>
		<script>
		var msg = document.getElementById("msg")
		var output = document.getElementById("output")
		var nick = document.getElementById("nick")
		var host = "emptyvoid.net:8080"
		var s = new WebSocket("ws://" + host + "/")
	
		s.onopen = function(e) {
			console.log("connected to " + host)
		}
	
		s.onclose = function(e) {
			console.log("closed connexion with " + host)
		}

		s.onmessage = function(e) {
			console.log("received: \"" + e.data + "\"")
			out(e.data)
		}

		msg.addEventListener("keypress", function(e) {
			if (e.keyCode == 13) {
				e.preventDefault()
				if (msg.value.replace(/\s/g, "") == "")
					return
				var data
				if (nick.value.replace(/\s/g, "") == "")
					data = "Anonymous: " + msg.value
				else
					data = nick.value + ": " + msg.value
				out(data)
				s.send(data)
				console.log("sent: \"" + data + "\"")
				msg.value = ""
			}
		}, true)
		
		function out(text) {
			var el = document.createElement("P")
			el.appendChild(document.createTextNode(text))
			if (output.firstChild)
				output.insertBefore(el, output.firstChild)
			else
				output.appendChild(el)
			document.body.scrollTop = 0
		}
		msg.focus()
		</script>
	</body>
</html>
